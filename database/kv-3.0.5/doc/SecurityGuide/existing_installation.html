<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Adding Security to an Existing Installation</title>
    <link rel="stylesheet" href="gettingStarted.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="Oracle NoSQL Database Security Guide" />
    <link rel="up" href="secure_installation.html" title="Chapter 3. Performing a Secure Oracle NoSQL Database Installation" />
    <link rel="prev" href="secure_installation.html" title="Chapter 3. Performing a Secure Oracle NoSQL Database Installation" />
    <link rel="next" href="password_storage.html" title="Chapter 4. External Password Storage" />
  </head>
  <body>
    <div xmlns="" class="navheader">
      <div class="libver">
        <p>Library Version DRAFT</p>
      </div>
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Adding Security to an Existing Installation</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="secure_installation.html">Prev</a> </td>
          <th width="60%" align="center">Chapter 3. Performing a Secure Oracle NoSQL Database Installation</th>
          <td width="20%" align="right"> <a accesskey="n" href="password_storage.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="existing_installation"></a>Adding Security to an Existing Installation</h2>
          </div>
        </div>
      </div>
      <p>
        To add security to an existing Oracle NoSQL Database installation: 
    </p>
      <div class="orderedlist">
        <ol type="1">
          <li>
            <p>
                Shut down the KVStore instance: 
            </p>
            <pre class="programlisting">java -jar KVHOME/lib/kvstore.jar stop \
-root KVROOT</pre>
          </li>
          <li>
            <p> 
                Run the <code class="literal">securityconfig</code>
                utility to set up the basic store configuration with
                security: 
            </p>
            <pre class="programlisting">java -jar /home/kvuser/kvstore/lib/kvstore.jar securityconfig </pre>
          </li>
          <li>
            <p>
                Use the <code class="literal">config create</code> command
                with the <code class="literal">-pwdmgr</code> option to specify
                the mechanism used to hold passwords that is needed
                for access to the stores. In this case, Oracle Wallet is used:
            </p>
            <pre class="programlisting">config create -pwdmgr wallet -root KVROOT
Creating SSL keystore 
Enter a password for your keystore: </pre>
          </li>
          <li>
            <p>
                Enter a password for your store and then reenter it
                for confirmation. The configuration tool will
                automatically generate some security related files: 
            </p>
            <pre class="programlisting">Enter a password for your keystore: ***********
Re-enter the password: ***********
Created files:
security/security.xml
security/store.keys
security/store.trust
security/store.wallet/cwallet.sso 
security/client.security 
security/client.trust  </pre>
          </li>
          <li>
            <p>
               Use the <code class="literal">config add-security</code> command to add
               the security configuration you just created:
            </p>
            <pre class="programlisting">config add-security \
-root KVROOT -secdir security  \
-config config.xml </pre>
          </li>
          <li>
            <p> 
                Start the Storage Node Agent (SNA): 
            </p>
            <pre class="programlisting">nohup java -jar KVHOME/lib/kvstore.jar start -root KVROOT&amp;</pre>
          </li>
          <li>
            <p>
                Start <code class="literal">runadmin</code> in security mode on the
                KVStore server host (node01). To do this, use the following
                command:
            </p>
            <pre class="programlisting">java -jar KVHOME/lib/kvstore.jar \
runadmin -port 5000 -host node01
-security KVROOT/security/client.security </pre>
            <p>
                This command sets SSL as a connection method and
                names a copy of the generated truststore file
                (client.security). For more information on SSL
                properties, see <a class="xref" href="ssl_comm.html" title="SSL communication properties">SSL communication properties</a>. 
            </p>
          </li>
          <li>
            <p> 
                Create a user. In this case, user
                <code class="literal">root</code> is defined: 
            </p>
            <pre class="programlisting">kv-&gt; plan create-user -name root -admin -wait
Enter the new password: ********
Re-enter the new password: ********
Executed plan 8, waiting for completion...
Plan 8 ended successfully </pre>
            <p>
                For more information on user creation and
                administration, see <a class="xref" href="config_auth.html#user_management" title="User management">User management</a>. 
            </p>
          </li>
          <li>
            <p> 
                At this point, it is possible to connect to the
                store as the root user. To login, you can use either the
                <code class="literal">-username &lt;user&gt;</code> or the 
                <code class="literal">-security &lt;path to security file&gt;</code> runadmin
                argument described earlier in this section.
            </p>
            <p>
                In this example, the oracle.kv.security property is used. To login
                use the following command:
            </p>
            <pre class="programlisting">java -Doracle.kv.security=mylogin.txt \
-jar KVHOME/lib/kvstore.jar runadmin </pre>
            <p>
               The file <code class="literal">mylogin.txt</code> should be a copy of the 
               <code class="literal">client.security</code> file with additional properties
               settings for authentication. The file would then contain content like this:
            </p>
            <pre class="programlisting">oracle.kv.auth.username=root
oracle.kv.auth.wallet.dir=login.wallet
oracle.kv.transport=ssl
oracle.kv.ssl.trustStore=client.trust
oracle.kv.ssl.protocols=TLSv1.2,TLSv1.1,TLSv1
oracle.kv.ssl.hostnameVerifier=dnmatch(CN\=NoSQL) </pre>
            <p>
           For more information, see
           <a class="xref" href="config_auth.html#user_login" title="User login">User login</a>.
        </p>
          </li>
        </ol>
      </div>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="secure_installation.html">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="secure_installation.html">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="password_storage.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Chapter 3. Performing a Secure Oracle NoSQL Database Installation </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Chapter 4. External Password Storage</td>
        </tr>
      </table>
    </div>
  </body>
</html>
