<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Chapter 3. Performing a Secure Oracle NoSQL Database Installation</title>
    <link rel="stylesheet" href="gettingStarted.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="start" href="index.html" title="Oracle NoSQL Database Security Guide" />
    <link rel="up" href="index.html" title="Oracle NoSQL Database Security Guide" />
    <link rel="prev" href="security_command.html" title="Configuring Security with Securityconfig" />
    <link rel="next" href="existing_installation.html" title="Adding Security to an Existing Installation" />
  </head>
  <body>
    <div xmlns="" class="navheader">
      <div class="libver">
        <p>Library Version DRAFT</p>
      </div>
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">Chapter 3. Performing a Secure Oracle NoSQL Database Installation</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="security_command.html">Prev</a> </td>
          <th width="60%" align="center"> </th>
          <td width="20%" align="right"> <a accesskey="n" href="existing_installation.html">Next</a></td>
        </tr>
      </table>
      <hr />
    </div>
    <div class="chapter" lang="en" xml:lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="secure_installation"></a>Chapter 3. Performing a Secure Oracle NoSQL Database Installation</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <p>
          <b>Table of Contents</b>
        </p>
        <dl>
          <dt>
            <span class="sect1">
              <a href="secure_installation.html#new_installation">Adding Security to a New Installation</a>
            </span>
          </dt>
          <dt>
            <span class="sect1">
              <a href="existing_installation.html">Adding Security to an Existing Installation</a>
            </span>
          </dt>
        </dl>
      </div>
      <p>
        It is possible to add security to a new or to an existing
        Oracle NoSQL Database installation. 
    </p>
      <p>
         The following examples describe how to add security to a new or to an existing Oracle NoSQL Database 
         single host deployment.
    </p>
      <div class="sect1" lang="en" xml:lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a id="new_installation"></a>Adding Security to a New Installation</h2>
            </div>
          </div>
        </div>
        <p>
        To install Oracle NoSQL Database securely:
    </p>
        <div class="orderedlist">
          <ol type="1">
            <li>
              <p> 
                Run the <code class="literal">makebootconfig</code> utility
                with the required <code class="literal">-store-security</code> option
                to set up the basic store configuration with security: 
            </p>
              <pre class="programlisting">java -jar KVHOME/lib/kvstore.jar makebootconfig \
-root KVROOT -port 5000 \
-admin 5001 -host node01 -harange 5010,5020 \
-store-security configure -capacity 1 </pre>
            </li>
            <li>
              <p>
                In this example, <code class="literal">-store-security
                configure</code> is used, so the
                <code class="literal">security configuration</code> utility
                is run as part of the makebootconfig process and you 
                are prompted for a password to use for your keystore file:
            </p>
              <pre class="programlisting">Creating SSL keystore
Enter a password for your keystore: </pre>
            </li>
            <li>
              <p>
                Enter a password for your store and then reenter it
                for confirmation. For example, in a Community Edition (CE)
                installation, the <code class="literal">securityconfig</code> 
                tool will automatically generate the following security related files:
            </p>
              <pre class="programlisting">Enter a password for your keystore: ***********
Re-enter the password: ***********
Created files:
security/security.xml
security/store.keys
security/store.trust
security/store.passwd
security/client.security 
security/client.trust </pre>
            </li>
            <li>
              <p>
                Start the Storage Node Agent (SNA):
            </p>
              <pre class="programlisting">nohup java -jar KVHOME/lib/kvstore.jar start -root KVROOT&amp;</pre>
              <p>
           When a newly created store with a secure configuration is first started,
           there are no user definitions available against which to authenticate access. 
           In order to reduce risk of unauthorized access, an admin will only allow you
           to connect to it from the host on which it is running. This security measure
           is not a complete safeguard against unauthorized
           access. It is important that you do not provide local access to machines
           running KVStore. In addition, you should perform steps 5, 6 and 7 soon after this
           step in order to minimize the time period in which the admin might be accessible 
           without full authentication. For more information on maintaining a secure
           store see <a class="xref" href="security_guidelines.html#guide_security" title="Guidelines for Securing the Configuration">Guidelines for Securing the Configuration</a>.           
        </p>
            </li>
            <li>
              <p>
                Start <code class="literal">runadmin</code> in security mode on the
                KVStore server host (node01). To do this, use the following
                command:
            </p>
              <pre class="programlisting">java -jar KVHOME/lib/kvstore.jar \
runadmin -port 5000 -host node01
-store-security KVROOT/security/client.security </pre>
            </li>
            <li>
              <p> 
                Use the <code class="literal">configure -name</code> command to specify
                the name of the KVStore that you want to configure:
            </p>
              <pre class="programlisting">configure -name mystore
Store configured: mystore </pre>
            </li>
            <li>
              <p> 
                Create a user. In this case, user
                <code class="literal">root</code> is defined: 
            </p>
              <pre class="programlisting">kv-&gt; plan create-user -name root -admin -wait
Enter the new password: ********
Re-enter the new password: ********
Executed plan 6, waiting for completion...
Plan 6 ended successfully  </pre>
              <p>
                For more information on user creation and
                administration, see <a class="xref" href="config_auth.html#user_management" title="User management">User management</a>.
            </p>
            </li>
            <li>
              <p> 
                At this point, it is possible to connect to the
                store as the root user. To login, you can use either the
                <code class="literal">-username &lt;user&gt;</code> or the 
                <code class="literal">-security &lt;path to security file&gt;</code> runadmin
                argument. 
            </p>
              <p>
               In this example, a security file (mylogin.txt) is used. To login,
               use the following command:
            </p>
              <pre class="programlisting">java -jar KVHOME/lib/kvstore.jar runadmin -security mylogin.txt </pre>
              <p>
               The file <code class="literal">mylogin.txt</code> should be a copy of the 
               <code class="literal">client.security</code> file with additional properties
               settings for authentication. The file would then contain content like this:
            </p>
              <pre class="programlisting">oracle.kv.auth.username=root
oracle.kv.auth.pwdfile.file=login.pwd
oracle.kv.transport=ssl
oracle.kv.ssl.trustStore=client.trust
oracle.kv.ssl.protocols=TLSv1.2,TLSv1.1,TLSv1
oracle.kv.ssl.hostnameVerifier=dnmatch(CN\=NoSQL) </pre>
              <p>
           For more information, see
           <a class="xref" href="config_auth.html#user_login" title="User login">User login</a>.
        </p>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <hr />
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="security_command.html">Prev</a> </td>
          <td width="20%" align="center"> </td>
          <td width="40%" align="right"> <a accesskey="n" href="existing_installation.html">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">Configuring Security with Securityconfig </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index.html">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> Adding Security to an Existing Installation</td>
        </tr>
      </table>
    </div>
  </body>
</html>
